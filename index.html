<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>外贸业务员 PI & 报价单生成器</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>业务助手</h2>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#" class="nav-link active" data-target="dashboard">主面板</a></li>
                    <li><a href="#" class="nav-link" data-target="pi-generator">生成PI/报价单</a></li>
                    <li><a href="#" class="nav-link" data-target="product-manager">商品管理</a></li>
                    <li><a href="#" class="nav-link" data-target="settings-manager">后台设置</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <button id="export-data-btn">导出数据 (备份)</button>
                <label for="import-data-input" class="import-data-label">导入数据 (恢复)</label>
                <input type="file" id="import-data-input" accept=".json">
                <p class="version">Version 8.0.0</p>
            </div>
        </aside>

        <main class="main-content">
            <div id="dashboard" class="module active">
                <h1>欢迎使用外贸业务助手 V8.0</h1>
                <p>此版本针对打印效果进行了决定性的优化，解决了行高过大的问题。</p>
                <h3>V8 更新日志:</h3>
                <ol>
                    <li><strong>【核心修复】</strong> 彻底解决了打印/生成PDF时，商品表格行高过大的问题，排版更紧凑专业。</li>
                    <li><strong>【UI 优化】</strong> 优化了打印表格的垂直对齐方式，内容将从顶部开始显示。</li>
                    <li><strong>【问题修复】</strong> 确认所有功能（如点击、小数输入、动态汇率）均可正常使用。</li>
                </ol>
            </div>

            <div id="pi-generator" class="module">
                <h2>生成PI/报价单</h2>
                <form id="pi-form">
                    <div class="form-grid">
                        <fieldset>
                            <legend>单据核心信息</legend>
                            <select id="doc-type">
                                <option value="QUOTATION">报价单 (QUOTATION)</option>
                                <option value="PROFORMA INVOICE">形式发票 (PROFORMA INVOICE)</option>
                            </select>
                            <select id="doc-currency"></select>
                            <input type="text" id="doc-incoterms" placeholder="贸易术语 (如: FOB Shanghai)" required>
                        </fieldset>
                        <fieldset>
                            <legend>客户信息</legend>
                            <input type="text" id="buyer-name" placeholder="客户公司名称" required>
                            <textarea id="buyer-address" placeholder="客户公司地址" required></textarea>
                            <input type="text" id="buyer-attn" placeholder="联系人 (Attn)" required>
                        </fieldset>
                        <fieldset>
                            <legend>我方与单据信息</legend>
                            <input type="text" id="doc-prepared-by" placeholder="制单人 (Prepared by)">
                            <div class="input-with-addon">
                                <input type="text" id="doc-id" placeholder="单据号">
                                <button type="button" id="generate-doc-id-btn" class="addon-btn"
                                    title="生成新单据号">&#x21bb;</button>
                            </div>
                            <div class="input-group">
                                <input type="number" id="doc-validity" placeholder="例如: 30">
                                <span class="input-group-text">Days</span>
                            </div>
                            <input type="date" id="doc-date" required>
                        </fieldset>
                    </div>

                    <h3>商品列表 (<span id="quote-currency-label">USD</span>)</h3>
                    <table id="quote-product-table">
                        <thead>
                            <tr>
                                <th style="width: 80px;">图片</th>
                                <th>商品描述</th>
                                <th style="width: 100px;">数量</th>
                                <th style="width: 80px;">单位</th>
                                <th style="width: 120px;">单价</th>
                                <th style="width: 150px;">金额</th>
                                <th style="width: 60px;">操作</th>
                            </tr>
                        </thead>
                        <tbody id="quote-product-list"></tbody>
                    </table>
                    <button type="button" id="show-product-modal-btn" class="btn-primary">从商品库添加</button>

                    <div class="form-grid-large-col">
                        <fieldset>
                            <legend>价格与条款</legend>
                            <div class="form-grid">
                                <div>
                                    <label for="port-loading">装运港</label><input type="text" id="port-loading">
                                    <label for="port-destination">目的港</label><input type="text" id="port-destination">
                                    <label for="payment-terms">付款方式</label><textarea id="payment-terms"
                                        rows="2"></textarea>
                                    <label for="lead-time">交货期</label><textarea id="lead-time" rows="2"></textarea>
                                </div>
                                <div class="totals-and-remarks">
                                    <div class="total-row"><label>商品总计:</label><span id="subtotal">0.00</span></div>
                                    <div class="total-row"><label for="freight-cost">运费:</label><input type="number"
                                            id="freight-cost" value="0" step="0.01"></div>
                                    <div class="total-row"><label for="insurance-cost">保险:</label><input type="number"
                                            id="insurance-cost" value="0" step="0.01"></div>
                                    <div class="total-row total-grand"><label>最终总计:</label><span
                                            id="grand-total">0.00</span></div>
                                    <label for="doc-remarks">备注</label><textarea id="doc-remarks" rows="2"></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>

                    <div class="form-actions"><button type="submit" class="btn-primary">生成预览 & 打印</button><button
                            type="reset" class="btn-secondary">重置表单</button></div>
                </form>
            </div>

            <div id="product-manager" class="module">
                <h2>商品管理</h2>
                <div class="manager-container">
                    <div class="form-section">
                        <h3>新增 / 编辑商品</h3>
                        <form id="product-form">
                            <input type="hidden" id="product-id">
                            <input type="text" id="product-model" placeholder="产品型号 (唯一)" required>
                            <input type="text" id="product-name" placeholder="产品名称" required>
                            <textarea id="product-specs" placeholder="产品规格" rows="3"></textarea>
                            <div class="image-source-selector"><label>图片来源:</label><label class="radio-label"><input
                                        type="radio" name="image-source" value="local" checked> 本地上传</label><label
                                    class="radio-label"><input type="radio" name="image-source" value="url">
                                    图片URL</label></div>
                            <div id="image-source-local"><label for="product-image-input"
                                    class="file-label">选择文件</label><input type="file" id="product-image-input"
                                    accept="image/*"><img id="product-image-preview" src="#" alt="图片预览"></div>
                            <div id="image-source-url" style="display: none;"><input type="text" id="product-image-url"
                                    placeholder="粘贴远程图片URL"></div>
                            <input type="hidden" id="product-image-storage">
                            <div class="form-grid-col2"><input type="text" id="product-unit"
                                    placeholder="单位 (e.g., PCS)" required><input type="text" id="product-hs-code"
                                    placeholder="HS Code (海关编码)"></div>
                            <textarea id="product-packaging" placeholder="包装信息 (如: 10pcs/carton)" rows="2"></textarea>
                            <div class="form-grid-col2">
                                <div class="input-group"><input type="number" id="product-net-weight" placeholder="净重"
                                        step="0.01"><span class="input-group-text">KGS</span></div>
                                <div class="input-group"><input type="number" id="product-gross-weight" placeholder="毛重"
                                        step="0.01"><span class="input-group-text">KGS</span></div>
                            </div>
                            <fieldset>
                                <legend>价格计算</legend>
                                <label>成本价 (<span id="cost-currency-label">CNY</span>):</label><input type="number"
                                    id="product-cost" required step="0.01">
                                <div class="image-source-selector"><label>利润算法:</label><label class="radio-label"><input
                                            type="radio" name="profit-algo" value="cost_plus" checked> 加成法</label><label
                                        class="radio-label"><input type="radio" name="profit-algo" value="margin">
                                        毛利法</label></div>
                                <input type="number" id="product-margin" placeholder="利润率 (%)" required step="0.01">
                                <div id="product-prices-display"></div>
                            </fieldset>
                            <div class="form-actions"><button type="submit" class="btn-primary">保存商品</button><button
                                    type="button" id="clear-product-form-btn" class="btn-secondary">清空表单</button></div>
                        </form>
                    </div>
                    <div class="list-section">
                        <h3>我的商品库</h3>
                        <table id="product-list-table">
                            <thead>
                                <tr>
                                    <th>型号</th>
                                    <th>名称</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="product-list-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="settings-manager" class="module">
                <h2>后台设置</h2>
                <form id="settings-form">
                    <fieldset>
                        <legend>我方公司信息</legend>
                        <input type="text" id="setting-company-name" placeholder="公司全称" required>
                        <textarea id="setting-company-address" placeholder="公司地址" required></textarea>
                        <input type="text" id="setting-company-contact" placeholder="电话, 邮箱等联系方式" required>
                        <div class="image-source-selector"><label>Logo来源:</label><label class="radio-label"><input
                                    type="radio" name="logo-source" value="local" checked> 本地上传</label><label
                                class="radio-label"><input type="radio" name="logo-source" value="url"> 图片URL</label>
                        </div>
                        <div id="logo-source-local"><label for="setting-company-logo-input"
                                class="file-label">选择文件</label><input type="file" id="setting-company-logo-input"
                                accept="image/*"><img id="setting-company-logo-preview" src="#" alt="Logo 预览"></div>
                        <div id="logo-source-url" style="display: none;"><input type="text"
                                id="setting-company-logo-url" placeholder="粘贴远程Logo图片URL"></div>
                        <input type="hidden" id="setting-company-logo-storage">
                    </fieldset>
                    <fieldset>
                        <legend>财务与币种</legend>
                        <textarea id="setting-bank-info" placeholder="必填项(形式发票PI): 银行名称, SWIFT, 账号等..."
                            rows="4"></textarea>
                        <label for="setting-base-currency">成本基准货币 (如: CNY)</label><input type="text"
                            id="setting-base-currency" value="CNY" required>

                        <label>销售币种与汇率</label>
                        <div id="currency-pairs-container">
                            <!-- Currency pairs will be dynamically inserted here by app.js -->
                        </div>
                        <button type="button" id="add-currency-btn" class="btn-secondary"
                            style="margin-top: -5px; padding: 8px 15px;">+ 添加币种</button>

                    </fieldset>
                    <fieldset>
                        <legend>默认条款</legend>
                        <input type="text" id="setting-default-port-loading" placeholder="默认装运港 (如: Shanghai, China)">
                        <input type="text" id="setting-default-incoterms" placeholder="默认贸易术语 (如: FOB Shanghai)">
                        <input type="text" id="setting-default-validity" placeholder="默认有效期 (如: 30)">
                        <textarea id="setting-default-payment" placeholder="默认付款方式" rows="3"></textarea>
                        <textarea id="setting-default-leadtime" placeholder="默认交货期" rows="2"></textarea>
                    </fieldset>
                    <button type="submit" class="btn-primary">保存设置</button>
                </form>
            </div>
        </main>
    </div>

    <div id="product-select-modal" class="modal">
        <div class="modal-content"><span class="close-modal-btn">&times;</span>
            <h2>选择商品</h2><input type="text" id="modal-search-input" placeholder="按型号或名称搜索...">
            <table class="modal-table">
                <thead>
                    <tr>
                        <th>图片</th>
                        <th>型号</th>
                        <th>名称</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="modal-product-list"></tbody>
            </table>
        </div>
    </div>

    <div id="print-preview-area"></div>

    <script src="app.js"></script>
</body>

</html>